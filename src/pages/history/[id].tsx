import Head from "next/head";
import { BackgroundEffect } from "../../ui/components/BackgroundEffect/BackgroundEffect";
import { Header } from "../../ui/components/Header/Header";
import React from "react";
import { Wrapper } from "../../ui/components/PageComponent/Wrapper/Wrapper";
import { TopLine, Section, Heading } from "../../ui/styles/_pageElements";
import styled from "styled-components";
import ImageGallery from "react-image-gallery";
import "react-image-gallery/styles/css/image-gallery.css";
import {
  getHistoryContentById,
  getHistoryMediaContentById,
  historyContentData,
} from "../../lib/historyPage";
import fs from "fs";
import path from "path";
import { getContentPath } from "../../lib/path";
import { GetStaticProps, GetStaticPropsContext, NextPage } from "next";
import ReactHTMLParser from "react-html-parser";
import v from "../../ui/styles/_variables";
const Content = styled.div`
  & ul {
    & li {
      list-style: disc;
      list-style-position: inside;
      margin-bottom: 5px;
    }
  }
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: ${v.primaryFont};
    margin: 2rem 0;
    font-weight: bold;
  }
  h6 {
    font-size: 22px;
  }
  & b {
    font-weight: 700;
  }
  & time {
    font-size: 14px;
    font-weight: 700;
  }
`;

const WrapperGallery = styled.div`
  max-width: 1200px;
  margin: 0 auto;
  margin-top: 85px;
  padding-bottom: 60px;
`;
const IndividualHistoryPage: NextPage<{
  data: historyContentData & { media: string[] };
}> = ({ data }) => {
  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <BackgroundEffect forPreview={false} />
        <Header />
        <Wrapper>
          <Section>
            <TopLine>
              <Heading>{ReactHTMLParser(data.heading)}</Heading>
            </TopLine>
            <Content>{ReactHTMLParser(data.content)}</Content>
            <WrapperGallery>
              {data.media.length > 0 && (
                <ImageGallery
                  autoPlay={true}
                  lazyLoad={true}
                  slideDuration={700}
                  slideInterval={10000}
                  items={data.media.map((item) => ({
                    original: item,
                    thumbnail: item,
                  }))}
                />
              )}
            </WrapperGallery>
          </Section>
        </Wrapper>
      </main>
    </>
  );
};

export async function getStaticPaths(context: any) {
  // Чекаем, существуют ли указаные пути на файлы, если нет, то 404
  const historyPostDirectory = path.join(getContentPath, "/history");
  const files = fs.readdirSync(historyPostDirectory);
  const paths = files.map((file) => ({
    params: { id: file.replace(".md", "") },
  }));
  return {
    paths,
    fallback: false,
  };
}

export const getStaticProps: GetStaticProps<any, { id: string }> = async ({
  params,
}) => {
  //если путь на файл существует то грузим данные
  const id = params!.id;
  const data = getHistoryContentById(id);
  const media = getHistoryMediaContentById(id);
  return {
    props: {
      data: {
        ...data,
        media,
      },
    },
  };
};

export default IndividualHistoryPage;
